version: '3.4'

services:

    apache:
        image: ${APACHE_CONTAINER_IMAGE}
        container_name: ${APACHE_CONTAINER_NAME}
        build: docker/apache
        ports:
            - ${APACHE_CONTAINER_IP}:${APACHE_CONTAINER_HTTP_PORT}:80
            - ${APACHE_CONTAINER_IP}:${APACHE_CONTAINER_HTTPS_PORT}:443
        volumes:
            - ${APACHE_CONTAINER_VOLUME}:/var/www/html
        depends_on:
            - php

    php:
        image: ${PHP_CONTAINER_IMAGE}
        container_name: ${PHP_CONTAINER_NAME}
        build:
            context: docker/php
            args:
                display_errors: ${PHP_DISPLAY_ERRORS:-0}
        ports:
            - ${APACHE_CONTAINER_IP}:${APACHE_CONTAINER_SSH_PORT}:22
        volumes:
            - ${APACHE_CONTAINER_VOLUME}:/var/www/html

    scheduler:
        image: ${PHP_CONTAINER_IMAGE}
        container_name: ${PHP_CONTAINER_NAME}-scheduler
        volumes:
            - ${APACHE_CONTAINER_VOLUME}:/var/www/html
        environment:
            CONTAINER_ROLE: scheduler
        depends_on:
            - php

    queue:
        image: ${PHP_CONTAINER_IMAGE}
        container_name: ${PHP_CONTAINER_NAME}-queue
        volumes:
            - ${APACHE_CONTAINER_VOLUME}:/var/www/html
            - ${APACHE_CONTAINER_VOLUME}/deploy/current/config/supervisor:/etc/supervisor
        environment:
            CONTAINER_ROLE: supervisor
        depends_on:
            - php
