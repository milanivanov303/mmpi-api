{
    "$id": "Create Issue",
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "description": "Issue object",
    "allOf": [
        {"$ref": "/api/v1/issues/issue.json"},
        {
            "required": [
                "tts_id",
                "jiraissue_id",
                "project"
            ],
            "properties": {
                "project": {
                    "properties": {
                        "name": {
                            "$filters": {
                                "$func": "checkInDb",
                                "$vars": {
                                    "rule": "exists:projects,name"
                                }
                            },
                            "$messages": {
                                "$filters": "Project with this name does not exist"
                            }
                        }
                    }
                },
                "tts_id": {
                    "$filters": {
                        "$func": "checkInDb",
                        "$vars": {
                            "rule": "unique:issues,tts_id"
                        }
                    },
                    "$messages": {
                        "pattern": "TTS key is not valid format",
                        "$filters": "TTS key is already registered"
                    }
                },
                "dev_instance": {
                    "properties": {
                        "name": {
                            "$filters": {
                                "$func": "checkInDb",
                                "$vars": {
                                    "rule": "exists:instances,name"
                                }
                            },
                            "$messages": {
                                "$filters": "Dev instance with this name does not exist"
                            }
                        }
                    }
                }
            }
        }
    ]
}
