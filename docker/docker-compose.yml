version: '3.3'

services:

    web:
        image: ${WEB_CONTAINER_IMAGE:-api-mmpi/web}
        container_name: ${WEB_CONTAINER_NAME:-api-mmpi}-${APP_ENV}
        build: web
        ports:
            - ${WEB_CONTAINER_IP}:${WEB_CONTAINER_SSH_PORT:-22}:22
            - ${WEB_CONTAINER_IP}:${WEB_CONTAINER_HTTP_PORT:-80}:80
            - ${WEB_CONTAINER_IP}:${WEB_CONTAINER_HTTPS_PORT:-443}:443
        volumes:
            - ${WEB_CONTAINER_VOLUME:-../.}:/var/www/html
        working_dir: /var/www/html
        restart: always
        networks:
            - local

    scheduler:
        image: ${WEB_CONTAINER_IMAGE:-api-mmpi/web}
        container_name: ${WEB_CONTAINER_NAME:-api-mmpi}-${APP_ENV}-scheduler
        volumes:
            - ${WEB_CONTAINER_VOLUME:-../.}:/var/www/html
        environment:
            CONTAINER_ROLE: scheduler
        depends_on:
            - web
        restart: always
        networks:
            - local

    queue:
        image: ${WEB_CONTAINER_IMAGE:-api-mmpi/web}
        container_name: ${WEB_CONTAINER_NAME:-api-mmpi}-${APP_ENV}-queue
        volumes:
            - ${WEB_CONTAINER_VOLUME:-../.}:/var/www/html
        environment:
            CONTAINER_ROLE: queue
        depends_on:
            - web
        restart: always
        networks:
            - local

networks:
    local:
        driver: bridge
